<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Order Success - Grill Nation</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff8f0;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: 60px auto;
      background: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }
    h2 {
      color: #008000;
    }
    .recommendations {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 10px;
    }
    .item {
      margin: 10px 0;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>âœ… Order placed successfully!</h2>
    <p>Thank you for your order. Weâ€™re preparing it for delivery ğŸšš</p>

    <div class="recommendations">
      <h3>ğŸ´ Next time, you might likeâ€¦</h3>
      <div id="recommendList">
        <!-- JS will inject recommendations here -->
      </div>
    </div>
<button onclick="window.location.href='/'" 
  style="
    background-color: red; 
    color: white; 
    font-size: 18px; 
    font-weight: bold;
    padding: 12px 24px; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer;
    margin-top: 20px;
  ">
  â¬… Back to Home
</button>

  </div>
<script>
  async function loadRecommendations() {
    try {
      console.log("ğŸ”„ Fetching recommendations from /api/recommendations...");
      const res = await fetch("/api/recommendations");
      console.log("ğŸ“¡ Response status:", res.status);

      const data = await res.json();
      console.log("ğŸ“¥ Raw API data:", data);

      const recList = document.getElementById("recommendList");
      recList.innerHTML = "";

      if (!Array.isArray(data)) {
        recList.innerHTML = `<p>âš ï¸ Error: Unexpected response format</p>`;
        return;
      }

      if (data.length === 0) {
        recList.innerHTML = "<p>No recommendations yet. Try ordering more ğŸ˜Š</p>";
      } else {
        data.forEach(item => {
          console.log("ğŸ‘‰ Rendering recommendation item:", item);

          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `
            <strong>${item.name}</strong> 
            ${item.price ? " - â‚¹" + item.price : ""} <br>

            <button onclick="addToCart('${item.name}', ${item.price || 0})"
              style="margin-top:8px; padding:6px 12px; background:#008000; color:white; border:none; border-radius:6px; cursor:pointer;">
              â• Add to Cart
            </button>

            <button onclick="quickOrder('${item.name}', ${item.price || 0})"
              style="margin-top:8px; margin-left:5px; padding:6px 12px; background:#ff6600; color:white; border:none; border-radius:6px; cursor:pointer;">
              ğŸ›’ Order Now
            </button>
          `;
          recList.appendChild(div);
        });
      }
    } catch (err) {
      console.error("âŒ Error loading recommendations:", err);
      document.getElementById("recommendList").innerHTML =
        "<p>âš ï¸ Failed to load recommendations.</p>";
    }
  }

  async function addToCart(itemName, price) {
    try {
      const res = await fetch("/add_to_cart", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ item: itemName, quantity: 1, price: price })
      });
      const data = await res.json();
      console.log("ğŸ›’ Add to cart response:", data);
      alert(data.message);
    } catch (err) {
      console.error("âŒ Error adding to cart:", err);
    }
  }

  async function quickOrder(itemName, price) {
    try {
      const res = await fetch("/quick_order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ item: itemName, quantity: 1, price: price })
      });
      const data = await res.json();
      console.log("âš¡ Quick order response:", data);
      alert(data.message);
      if (data.success) window.location.href = "/success";
    } catch (err) {
      console.error("âŒ Error placing quick order:", err);
    }
  }

  loadRecommendations();
</script>
</body>
</html>
